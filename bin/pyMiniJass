#!/usr/bin/env python
import os
import sys, signal, argparse, logging

from pyMiniJass.game import Game
from pyMiniJass.player.cli_player import CliPlayer
from pyMiniJass.player.random_player import RandomPlayer
from reinforcement.rl_player import RlPlayer


def start_tournament():
    dir_path = os.path.dirname(os.path.realpath(__file__))
    parent_dir = os.path.abspath(os.path.join(dir_path, os.pardir))
    model_path_1 = parent_dir + '/reinforcement/weights/rl1_model_mini.h5'
    rl_player = RlPlayer(name='RL1', model_path=model_path_1)
    tick = RandomPlayer(name='Tick')
    track = RandomPlayer(name='Track')
    cli_player = CliPlayer(name='Yourself')
    players = [rl_player, cli_player, tick, track]
    game = Game(players=players)
    game.play()


def set_logging():
    root = logging.getLogger()
    root.setLevel(logging.INFO)
    stream_handler = logging.StreamHandler(sys.stdout)
    stream_handler.setLevel(logging.INFO)
    formatter = logging.Formatter('%(message)s')
    stream_handler.setFormatter(formatter)
    root.addHandler(stream_handler)


def handler(signum, frame):
    print('\n pyMiniJass terminated!  Goodbye!')
    sys.exit(0)


if __name__ == "__main__":
    set_logging()
    signal.signal(signal.SIGINT, handler)
    parser = argparse.ArgumentParser(description='CLI pyMiniJass', )
    args = parser.parse_args()
    start_tournament()
